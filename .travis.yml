sudo: required
services:
  - xvfb
  - docker
notifications:
  email: false
cache:
  - ccache

language: cpp
matrix:
  include:
    - name: "Xenial"
      dist: xenial

before_install:
  - docker pull thethingsindustries/protoc

install:
  - docker run apt-get clean
  - docker run apt update
  - docker run apt-get install -y ccache ninja-build python3 python3-pip autoconf automake libtool make g++ unzip lcov gcovr qtbase5-dev libzmq3-dev libzmqpp-dev libarmadillo-dev

before_script:

# Compile and test (mark the build as failed if any step fails). If the
# CATKIN_OPTIONS file exists, use it as an argument to catkin_make, for example
# to blacklist certain packages.
#
script:
  - docker run cd ~
  - docker run export CC="ccache gcc"
  - docker run export CXX="ccache g++"
  - docker run export CCACHE_SLOPPINESS=pch_defines,time_macros
  - docker run git clone https://github.com/RoboTeamTwente/roboteam_suite roboteam_suite --recurse-submodules
  - docker run cd ~/roboteam_suite
  - docker run mkdir cmake-build-debug && cd cmake-build-debug
  - docker run cmake -DCMAKE_BUILD_TYPE=Debug -G "CodeBlocks - Ninja" ..
  - docker run make -j 8
  - docker run make roboteam_proto
  - docker run make roboteam_utils
  - docker run make ai_tests
  - docker run ./roboteam_ai/ai_tests

after_success:
  - bash <(curl -s https://codecov.io/bash) -f roboteam_ai_coverage.info.cleaned || echo "Codecov did not collect coverage reports"
