sudo: required
services:
  - xvfb
notifications:
  email: false
cache:
  - ccache

language: cpp
matrix:
  include:
    - name: "Xenial"
      dist: xenial

before_install:
  - sudo apt-get clean
  - sudo apt update
  - sudo apt-get install -y ccache ninja-build autoconf automake libtool curl make g++ unzip libprotobuf-dev protobuf-compiler lcov gcovr qtbase5-dev libzmq3-dev libzmqpp-dev libarmadillo-dev

  - export CC="ccache gcc"
  - export CXX="ccache g++"

  #install protobuf
  - curl -OL https://github.com/protocolbuffers/protobuf/releases/download/v3.9.1/protobuf-cpp-3.9.1.zip
  - unzip protobuf-cpp-3.9.1.zip -d protobuf
  - cd protobuf/protobuf-3.9.1
  - ./configure
  - make
  - make check
  - sudo make install
  - sudo ldconfig # refresh shared library cache.

install:

before_script:

# Compile and test (mark the build as failed if any step fails). If the
# CATKIN_OPTIONS file exists, use it as an argument to catkin_make, for example
# to blacklist certain packages.
#
script:
  - cd ~
  - export CC="ccache gcc"
  - export CXX="ccache g++"
  - export CCACHE_SLOPPINESS=pch_defines,time_macros
  - git clone https://github.com/RoboTeamTwente/roboteam_suite roboteam_suite --recurse-submodules
  - cd ~/roboteam_suite
  - mkdir cmake-build-debug && cd cmake-build-debug
  - cmake -DCMAKE_BUILD_TYPE=Debug -G "CodeBlocks - Ninja" ..
  - make -j 8
  - make roboteam_proto
  - make roboteam_utils
  - make ai_tests
  - ./roboteam_ai/ai_tests

after_success:
  - bash <(curl -s https://codecov.io/bash) -f roboteam_ai_coverage.info.cleaned || echo "Codecov did not collect coverage reports"
