language: cpp
os: osx
osx_image: xcode11.2

addons:
  homebrew:
    packages:
      - zmq
      - zmqpp
      - protobuf
      - armadillo
      - ccache
      - gtest

notifications:
  email: false

cache:
  directories:
    - $HOME/Library/Caches/Homebrew

install:
  - cd ~/
  - git clone https://github.com/google/googletest.git
  - cd googletest
  - mkdir install
  - cd install
  - cmake ../  #creates a make file
  - make #compiles Google Test
  - sudo make install #installs Google Test

script:
  - cd ~
  - export CC="ccache gcc"
  - export CXX="ccache g++"
  - export CCACHE_SLOPPINESS=pch_defines,time_macros
  - git clone https://github.com/RoboTeamTwente/roboteam_suite roboteam_suite --recurse-submodules
  - cd ~/roboteam_suite
  - rm -rf roboteam_ai
  - git submodule foreach git checkout master
  - mv ${TRAVIS_BUILD_DIR} .
  - mkdir cmake-build-debug && cd cmake-build-debug;
  - cmake -DCMAKE_BUILD_TYPE=Debug -G "CodeBlocks - Ninja" ..
  - cmake --build . --target ai_tests -- -j 8




#services:
#- xvfb

#- sudo apt-get install -y ccache ninja-build python3 python3-pip autoconf automake libtool make g++ unzip lcov gcovr qtbase5-dev libzmq3-dev libzmqpp-dev libarmadillo-dev

# Build Protobuf from source
#install:
#- export CC="ccache gcc"
#- export CXX="ccache g++"
#- cd ~
#- wget https://github.com/protocolbuffers/protobuf/releases/download/v3.9.1/protobuf-cpp-3.9.1.tar.gz
#- tar -xzvf protobuf-cpp-3.9.1.tar.gz
#- pushd protobuf-3.9.1 && ./configure --prefix=/usr && make && sudo make install && popd
#
#before_script:

after_success:
- bash <(curl -s https://codecov.io/bash) -f roboteam_ai_coverage.info.cleaned || echo "Codecov did not collect coverage reports"
